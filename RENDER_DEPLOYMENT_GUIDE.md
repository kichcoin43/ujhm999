# Руководство по деплою на Render.com

Это руководство описывает процесс деплоя приложения BNAL Bank на Render.com.

## Предварительные требования

1. Аккаунт на [Render.com](https://render.com)
2. Git репозиторий с кодом проекта
3. Токен Telegram бота

## Конфигурация проекта

Проект уже подготовлен для деплоя на Render.com. Основные файлы конфигурации:

- `render.yaml` - основной файл конфигурации для Render.com
- `build.sh` - скрипт для сборки проекта
- `start.sh` - скрипт для запуска проекта
- `package.json` - файл с зависимостями

## Шаги по деплою

### 1. Подготовка проекта

Проект уже подготовлен для деплоя. Все необходимые файлы находятся в директории `render-app`.

### 2. Создание нового Web Service на Render.com

1. Войдите в свой аккаунт на Render.com
2. Нажмите "New +" в верхнем правом углу и выберите "Web Service"
3. Подключите свой Git репозиторий
4. Укажите следующие настройки:
   - **Name**: `bnal-bank` (или другое имя по вашему выбору)
   - **Environment**: `Node`
   - **Region**: Выберите ближайший регион к вашим пользователям
   - **Branch**: `main` (или другую ветку, содержащую код проекта)
   - **Root Directory**: `render-app` (важно указать эту директорию)
   - **Build Command**: `./build.sh`
   - **Start Command**: `./start.sh`

### 3. Настройка переменных окружения

Добавьте следующие переменные окружения в разделе "Environment Variables":

- `NODE_ENV`: `production`
- `RENDER`: `true`
- `TELEGRAM_BOT_TOKEN`: Токен вашего Telegram бота
- `SESSION_SECRET`: Случайная строка для безопасности сессий

### 4. Настройка диска для хранения данных

1. Перейдите в раздел "Disks" в настройках вашего Web Service
2. Добавьте диск со следующими параметрами:
   - **Mount Path**: `/data`
   - **Size**: 1 GB (или больше, если необходимо)

### 5. Деплой приложения

1. Нажмите кнопку "Create Web Service"
2. Render.com автоматически выполнит сборку и запуск приложения
3. После успешного деплоя, вы получите URL приложения (например, `https://bnal-bank.onrender.com`)

### 6. Настройка Telegram бота

Для корректной работы Telegram бота:

1. Убедитесь, что в переменных окружения указан правильный `TELEGRAM_BOT_TOKEN`
2. Установите `WEBAPP_URL` на URL вашего приложения на Render.com
3. Webhook для бота будет настроен автоматически при запуске приложения

## Проверка работоспособности

После деплоя вы можете проверить работоспособность приложения:

1. Откройте URL вашего приложения в браузере
2. Проверьте эндпоинт `/api/render-status` для информации о статусе деплоя
3. Отправьте команду `/start` боту в Telegram

## Мониторинг и отладка

- Логи приложения доступны в разделе "Logs" на Render.com
- Эндпоинт `/api/telegram-info` предоставляет информацию о настройках Telegram бота
- При возникновении проблем с базой данных, проверьте, что диск правильно примонтирован

## Резервное копирование и восстановление данных

Приложение поддерживает автоматическое создание резервных копий базы данных. Резервные копии сохраняются в директории `/data/backup`.

Для ручного управления резервными копиями:
- Создание резервной копии: `/api/backup` (требуется авторизация регулятора)
- Восстановление из резервной копии: `/api/restore` (требуется авторизация регулятора)

## Важные замечания

1. Первый запуск приложения может занять некоторое время, так как необходимо создать все таблицы в базе данных
2. При первом запуске автоматически создается пользователь-регулятор с логином `admin` и паролем `admin`
3. В режиме production Telegram бот работает через webhook, что обеспечивает мгновенную обработку сообщений